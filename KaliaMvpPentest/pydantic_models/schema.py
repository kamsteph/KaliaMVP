from datetime import datetime
from typing import Optional, List, Dict, Any
from wsgiref.validate import validator

from pydantic import BaseModel, Field

class ScopeItem(BaseModel):
    scope: Optional[str] = None
    target: Optional[str] = None
    insider_file_ids: List[str] = Field(default_factory=list)
    codebase_file_ids: List[str] = Field(default_factory=list)
    vuln_tools: List[str] = Field(default_factory=list)
    exploit_tool: Optional[str] = "Default"

class ScanRequest(BaseModel):
    region: str
    scope: str
    scan_type: str
    target: List[str]
    attack_surface: List[str]
    export_format: str = "json"
    cross_domain_insight: bool = False
    name: Optional[str] = None
    description: Optional[str] = None
    social_media_url: Optional[str] = None
    scopes: List[ScopeItem] = Field(default_factory=list)
    tools: Dict[str, Any] = Field(default_factory=dict)
    top_ports: Optional[int] = None
    ports: Optional[List[int]] = None

class UploadedFile(BaseModel):
    id: str
    filename: str
    stored_path: str
    uploaded_at: datetime
    scope: str

